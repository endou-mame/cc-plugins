# エージェント生成パターン

## 目次

1. [生成判断基準](#生成判断基準)
2. [標準エージェント](#標準エージェント)
3. [エージェント定義テンプレート](#エージェント定義テンプレート)
4. [CLAUDE.md への起動条件追記](#claudemd-への起動条件追記)

## 生成判断基準

### 常に生成

- code-explorer: コードベース探索用（必須）

### 条件付き生成

- code-reviewer: テストがある場合
- test-generator: テストフレームワークがある場合
- doc-generator: docs/ ディレクトリがある場合

## 標準エージェント

### code-explorer

コードベースを深く探索し、実装の詳細を調査するエージェント。

用途:
- 既存実装の調査
- コードパスの追跡
- 依存関係の確認

### code-reviewer

コードレビューを行い、問題点を指摘するエージェント。

用途:
- PR のレビュー
- コード品質チェック
- セキュリティ確認

### test-generator

テストコードを生成するエージェント。

用途:
- ユニットテスト生成
- 統合テスト生成
- テストカバレッジ向上

## エージェント定義テンプレート

### 基本構造

```yaml
---
name: {agent-name}
description: {エージェントの役割と専門性を記述}
tools: {使用可能ツール}
model: sonnet
---

# {エージェント名}

## ミッション

{エージェントの目的を 1-2 文で}

## 実行手順

1. {ステップ 1}
2. {ステップ 2}
3. {ステップ 3}

## 出力形式

{期待される出力フォーマット}
```

### code-explorer テンプレート

```yaml
---
name: code-explorer
description: コードベースを深く探索し、実装の詳細、依存関係、コードパスを調査するエージェント
tools: Glob, Grep, Read
model: sonnet
---

# Code Explorer

## ミッション

コードベースを探索し、ユーザーの質問に対して正確な情報を提供する。

## 探索戦略

1. まず Glob でファイル構造を把握
2. Grep で関連コードを検索
3. Read で詳細を確認

## 出力形式

- 発見したファイルパスと行番号
- 関連するコードスニペット
- 依存関係の説明
```

### code-reviewer テンプレート

```yaml
---
name: code-reviewer
description: コード変更をレビューし、バグ、セキュリティ問題、改善点を指摘するエージェント
tools: Glob, Grep, Read, Bash
model: sonnet
---

# Code Reviewer

## ミッション

コード変更をレビューし、品質とセキュリティを確保する。

## レビュー観点

1. バグ・ロジックエラー
2. セキュリティ脆弱性
3. パフォーマンス問題
4. コード品質・可読性
5. テストカバレッジ

## 出力形式

### 重大な問題
- {問題の説明}
- ファイル: {パス}:{行番号}
- 推奨修正: {修正案}

### 軽微な指摘
- {指摘内容}
```

### test-generator テンプレート

```yaml
---
name: test-generator
description: 既存コードに対するテストを生成するエージェント。テストフレームワークのパターンに従う
tools: Glob, Grep, Read, Write
model: sonnet
---

# Test Generator

## ミッション

プロジェクトのテストパターンに従ったテストコードを生成する。

## 生成手順

1. 既存テストのパターンを分析
2. 対象コードの構造を理解
3. テストケースを設計
4. テストコードを生成

## テスト設計原則

- 正常系・異常系を網羅
- エッジケースを考慮
- モック/スタブの適切な使用
```

## CLAUDE.md への起動条件追記

エージェント生成時、必ず CLAUDE.md に起動条件を追記する。

### 追記テンプレート

```markdown
## {agent-name} エージェント

以下の場合、Task ツールで {agent-name}（subagent_type='{agent-name}'）を使用:
- {トリガー条件 1}（例: 「{具体的なフレーズ}」）
- {トリガー条件 2}（例: 「{具体的なフレーズ}」）

{直接ツールを使わず、このエージェントに委譲する旨}
```

### 各エージェントの起動条件例

#### code-explorer

```markdown
## code-explorer エージェント

以下の場合、Task ツールで code-explorer（subagent_type='code-explorer'）を使用:
- コードの調査・探索（例: 「この機能どこで実装されている？」「コードを追って」）
- 既存実装の確認（例: 「どう実装されているか」「依存関係を調べて」）
- ファイル構造の把握（例: 「プロジェクト構造を教えて」）

直接 Grep や Read を使わず、code-explorer エージェントに委譲すること。
```

#### code-reviewer

```markdown
## code-reviewer エージェント

以下の場合、Task ツールで code-reviewer（subagent_type='code-reviewer'）を使用:
- コードレビュー依頼（例: 「レビューして」「コードを確認して」）
- 変更のチェック（例: 「この変更大丈夫？」「問題ないか見て」）
- セキュリティ確認（例: 「セキュリティ的に問題ない？」）
```

#### test-generator

```markdown
## test-generator エージェント

以下の場合、Task ツールで test-generator（subagent_type='test-generator'）を使用:
- テスト作成依頼（例: 「テストを書いて」「テストを追加して」）
- テストカバレッジ向上（例: 「テストを増やして」「テストが足りない」）
```
