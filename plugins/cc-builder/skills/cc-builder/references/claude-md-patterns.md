# CLAUDE.md 生成パターン

## 目次

1. [基本原則](#基本原則)
2. [構造テンプレート](#構造テンプレート)
3. [セクション別ガイドライン](#セクション別ガイドライン)
4. [エージェント起動条件の書き方](#エージェント起動条件の書き方)
5. [アンチパターン](#アンチパターン)

## 基本原則

### 簡潔性

- 60 行以下が理想
- 最大 300 行まで
- 普遍的に適用可能な内容のみ

### WHAT/WHY/HOW 構造

- WHAT: 技術スタック、プロジェクト構造
- WHY: プロジェクトの目的
- HOW: コマンド、ワークフロー

### Progressive Disclosure

- 詳細は skills に分離
- CLAUDE.md には参照リンクのみ

## 構造テンプレート

```markdown
## 概要

{プロジェクトの目的を 1-2 文で}

## 技術スタック

- 言語: {言語}
- フレームワーク: {フレームワーク}
- パッケージマネージャー: {npm/pnpm/yarn/bun}

## コマンド

- 開発: `{dev コマンド}`
- ビルド: `{build コマンド}`
- テスト: `{test コマンド}`
- リント: `{lint コマンド}`

## ディレクトリ構造

- `{src}/` - ソースコード
- `{tests}/` - テスト

## エージェント

### code-explorer

以下の場合、Task ツールで code-explorer（subagent_type='code-explorer'）を使用:
- 「コードを調べて」「実装を確認して」
- 「どこで定義されている？」
```

## セクション別ガイドライン

### 概要セクション

プロジェクトの目的を簡潔に記述。package.json の description や README の冒頭から抽出。

良い例:

```markdown
## 概要

ユーザー認証と課金機能を持つ SaaS アプリケーション。Next.js + Supabase で構築。
```

悪い例:

```markdown
## 概要

このプロジェクトは、最新の技術スタックを使用して構築された、
スケーラブルでメンテナンス性の高いウェブアプリケーションです。
主な機能として、ユーザー認証、データベース連携、API 統合...（続く）
```

### 技術スタックセクション

箇条書きで簡潔に。バージョン番号は不要（陳腐化しやすい）。

良い例:

```markdown
## 技術スタック

- 言語: TypeScript
- フレームワーク: Next.js（App Router）
- スタイル: Tailwind CSS
- DB: PostgreSQL + Prisma
```

### コマンドセクション

実際に動作するコマンドのみ。存在しないコマンドは書かない。

```markdown
## コマンド

- 開発サーバー: `npm run dev`
- ビルド: `npm run build`
- テスト: `npm run test`
- リント: `npm run lint`
- 型チェック: `npm run typecheck`
```

### ディレクトリ構造セクション

主要なディレクトリのみ。深い階層は書かない。

```markdown
## ディレクトリ構造

- `app/` - Next.js App Router ページ
- `components/` - React コンポーネント
- `lib/` - ユーティリティ、ヘルパー
- `prisma/` - データベーススキーマ
```

## スキル参照の書き方

CLAUDE.md から skills を参照する方法を記述する。

### フォーマット

```markdown
## スキル

以下のスキルが利用可能:

- `{skill-name}`: {スキルの説明}（トリガー: 「{具体的なフレーズ}」）
```

### 例

```markdown
## スキル

以下のスキルが利用可能:

- `project-domain`: ドメイン知識（トリガー: 「DB スキーマを確認」「API 仕様を参照」）
- `development-workflow`: 開発ワークフロー（トリガー: 「機能を追加」「バグを修正」）
```

### スキルとエージェントの使い分け

CLAUDE.md では、スキルとエージェントを明確に分けて記載する:

- スキル: 知識・参照情報を提供（ドメイン知識、API 仕様、ワークフロー手順）
- エージェント: タスクを自律的に実行（コード探索、レビュー、テスト生成）

同じ内容を両方に記載しない。例えば:
- API 仕様の「参照」はスキル
- コードの「調査・探索」はエージェント（code-explorer）

## エージェント起動条件の書き方

発動率 100% を達成するため、CLAUDE.md にエージェント起動条件を明記する。

### フォーマット

```markdown
## {エージェント名}

以下の場合、Task ツールで {エージェント名}（subagent_type='{エージェント名}'）を使用:
- {トリガー条件 1}（例: 「{具体的なフレーズ}」）
- {トリガー条件 2}
```

### 例

```markdown
## code-explorer エージェント

以下の場合、Task ツールで code-explorer（subagent_type='code-explorer'）を使用:
- コードの調査や探索（例: 「この機能どこで実装されている？」「コードを追って」）
- 既存実装の確認（例: 「どう実装されているか確認して」）

直接 Grep や Read を使わず、必ず code-explorer エージェントに委譲すること。

## code-reviewer エージェント

以下の場合、Task ツールで code-reviewer（subagent_type='code-reviewer'）を使用:
- コードレビュー依頼（例: 「レビューして」「コードを確認して」）
- 変更のチェック（例: 「この変更大丈夫？」）
```

## アンチパターン

### 避けるべき内容

1. コードスタイルガイドライン（リンターに任せる）
2. タスク固有の指示
3. 陳腐化しやすいコードスニペット
4. 過度に詳細な説明
5. 太字の多用

### 避けるべき記述例

```markdown
## コーディング規約

- インデントは 2 スペース
- セミコロンは省略
- シングルクォートを使用
- 関数は必ずアロー関数で
```

↑ これらは ESLint/Prettier で自動化すべき

```markdown
## API の使い方

以下のようにリクエストを送信します：

\`\`\`typescript
const response = await fetch('/api/users', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name, email }),
});
const data = await response.json();
\`\`\`
```

↑ 詳細なコード例は skills に分離すべき
