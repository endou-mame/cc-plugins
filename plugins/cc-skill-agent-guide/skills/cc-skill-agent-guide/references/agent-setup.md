# サブエージェント設定詳細

## ファイル配置

```
.claude/agents/{agent-name}.md
```

## フォーマット

```yaml
---
name: agent-name
description: 説明文。「〇〇して」「△△したい」で使用。
allowed-tools: Bash, Read, Skill  # 使用可能ツール
---

# エージェント本文

## 目的
[このエージェントが何をするか]

## 出力形式
[期待する出力フォーマット]
```

## description の書き方

発動率を上げるため、具体的なトリガー例を列挙する。

悪い例:
```yaml
description: ファイルの行数をカウント
```

良い例:
```yaml
description: ファイルの行数をカウント。「行数を数えて」「何行ある？」「行数教えて」「wc して」で使用。
```

## 発動率の現実

description のみに依存した場合の発動率:

| プロンプト | 発動 |
|-----------|------|
| 行数を数えて | ✅ (description と一致) |
| 何行ある？ | ❌ |
| 行数教えて | ❌ |
| カウントして | ❌ |

**発動率: 約25%**

## 発動率を100%にする方法

CLAUDE.md に起動条件を明記:

```markdown
## line-counter エージェント

ユーザーが以下のいずれかを尋ねた場合、**必ず** Task ツールで
`line-counter` エージェント（subagent_type='line-counter'）を使用：

- ファイルの行数について（例: 「行数を数えて」「何行ある？」「行数教えて」）
- 行のカウントについて（例: 「カウントして」「wc して」）

直接 Bash で処理せず、必ず line-counter エージェントに委譲すること。
```

**発動率: 100%**

## allowed-tools の選択

| ツール | 用途 |
|--------|------|
| Bash | コマンド実行 |
| Read | ファイル読み取り |
| Write | ファイル書き込み |
| Glob | ファイル検索 |
| Skill | スキル参照 |
| WebSearch | Web 検索 |

## スキルからの知識参照

サブエージェントからスキルを参照する方法:

1. `allowed-tools` に `Skill` を含める → Skill ツール経由
2. `allowed-tools` に `Read, Glob` を含める → ファイル直接読み取り

どちらでも `.claude/skills/` 内の知識にアクセス可能。

## 出力形式の固定

エージェントの出力形式を固定したい場合:

```markdown
## 出力形式

必ず以下の形式で出力:

🔢 Line Counter
━━━━━━━━━━━━━━━━
ファイル: {ファイル名}
行数: {N} 行
━━━━━━━━━━━━━━━━
```

ユーザーに「そのまま表示して」と言われた場合は形式を保持。
